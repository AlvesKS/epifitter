<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitting disease progress curves to classic epidemiological models • epifitter</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fitting disease progress curves to classic epidemiological models">
<meta property="og:description" content="epifitter">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-177181576-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-177181576-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epifitter</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/fitting.html">Fitting disease progress curves to classic epidemiological models</a>
    </li>
    <li>
      <a href="../articles/simulation.html">Simulating disease progress curves</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/AlvesKS/epifitter/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fitting disease progress curves to classic epidemiological models</h1>
                        <h4 class="author">Kaique S Alves</h4>
            
            <h4 class="date">2020-09-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/AlvesKS/epifitter/blob/master/vignettes/fitting.Rmd"><code>vignettes/fitting.Rmd</code></a></small>
      <div class="hidden name"><code>fitting.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Use <code>epifitter</code> to fit the classic epidemiological models, <em>Exponential</em>, <em>Monomolecular</em>, <em>Logistic</em>, <em>Gompertz</em>, to your disease progress curves (DPCs). This package is optimized to fit theses models using data linearization approach using the function <code>fit_lin</code> and nonlinear regression using the functions <code>fit_nlin</code> and <code>fit_nlin2</code>. And if you have tons of DPCs in your dataset, I would recommend to you to use the <code><a href="../reference/multi_fitter.html">multi_fitter()</a></code> function, which can fit all theses model to each of your DPCs.</p>
<p>In this vignette I will demonstrate the main features about these functions, using them in some simulated data. I hope you appreciate it. Have fun!</p>
</div>
<div id="hands-on" class="section level1">
<h1 class="hasAnchor">
<a href="#hands-on" class="anchor"></a>Hands on</h1>
<div id="packages" class="section level2">
<h2 class="hasAnchor">
<a href="#packages" class="anchor"></a>Packages</h2>
<p>First we have to load some packages. If you don’t have any of theses, please install it with the function <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code>.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">epifitter</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)</pre></body></html></div>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>To demonstrate the fitting procedure, first we need some data. Let’s use the function <code>sim_logistic</code> to do that. You can check on <code><a href="../reference/sim_logistic.html">?sim_logistic</a></code> to see details about this function.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">dpc_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_logistic.html">sim_logistic</a></span>(
  <span class="kw">N</span> <span class="kw">=</span> <span class="fl">100</span>,
  <span class="kw">y0</span> <span class="kw">=</span> <span class="fl">0.01</span>,
  <span class="kw">dt</span> <span class="kw">=</span> <span class="fl">5</span>,
  <span class="kw">r</span> <span class="kw">=</span> <span class="fl">0.1</span>,
  <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.2</span>,
  <span class="kw">n</span> <span class="kw">=</span> <span class="fl">7</span>
)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">dpc_data</span>)</pre></body></html></div>
<pre><code>##   replicates time          y   random_y
## 1          1    0 0.01000000 0.01000000
## 2          1    5 0.01638216 0.01500528
## 3          1   10 0.02672677 0.03402059
## 4          1   15 0.04331509 0.05828692
## 5          1   20 0.06946352 0.06615314
## 6          1   25 0.10958806 0.08471828</code></pre>
</div>
<div id="using-fit_lin-to-fit-dpcs-using-data-linearization" class="section level2">
<h2 class="hasAnchor">
<a href="#using-fit_lin-to-fit-dpcs-using-data-linearization" class="anchor"></a>Using <code>fit_lin()</code> to fit DPCs using data linearization</h2>
<p>The <code><a href="../reference/fit_lin.html">fit_lin()</a></code> function fits DPCs to classic epidemiological models using linearization of the disease intensity. To use this function you need to provide the following arguments:</p>
<ul>
<li>
<code>time</code>: A vector containing time steps of the DPCs.</li>
<li>
<code>y</code>: A vector with the disease intensity data.</li>
</ul>
<p>In our data <code>dpc_data</code> we can call these vectors using the <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> operator, like bellow:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">f_lin</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fit_lin.html">fit_lin</a></span>(<span class="kw">time</span> <span class="kw">=</span> <span class="no">dpc_data</span>$<span class="no">time</span>,
                 <span class="kw">y</span> <span class="kw">=</span> <span class="no">dpc_data</span>$<span class="no">random_y</span>)
<span class="no">f_lin</span></pre></body></html></div>
<pre><code>## Results of fitting population models 
## 
## Stats:
##                  CCC r_squared    RSE
## Logistic      0.9977    0.9954 0.2056
## Gompertz      0.9793    0.9595 0.4463
## Monomolecular 0.9388    0.8846 0.6056
## Exponential   0.9097    0.8343 0.6053
## 
##  Infection rate:
##                 Estimate  Std.error      Lower      Upper
## Logistic      0.09955701 0.03274422 0.09844982 0.09844982
## Gompertz      0.07127112 0.07107068 0.06886799 0.06886799
## Monomolecular 0.05500605 0.09643781 0.05174518 0.05174518
## Exponential   0.04455096 0.09638038 0.04129202 0.04129202
## 
##  Initial inoculum:
##                    Estimate         Lower         Upper
## Logistic       1.035852e-02  9.715679e-03  1.104342e-02
## Gompertz       2.267008e-05  4.518525e-06  9.206941e-05
## Monomolecular -1.908147e+00 -2.518806e+00 -1.403463e+00
## Exponential    3.043941e-02  2.515976e-02  3.682695e-02</code></pre>
<div id="so-what" class="section level4">
<h4 class="hasAnchor">
<a href="#so-what" class="anchor"></a>So what?</h4>
<p>Note the first part of the output we have the <code>Stats</code> for each model. In this section are shown the Lin’s concordance correlation coefficient <code>CCC</code> (Lin 2000) for each, the coefficient of determination <code>r_squared</code> (R<sup>2</sup>) and the residual standard deviation <code>RSE</code>. In this output the models are sorted by from the higher <code>CCC</code> to the lower <code>CCC</code>, there is, from the more accurate to the less accurate model. In our case the more accurate model is the <em>Logistic</em> model.</p>
<p>Right above is presented the sections <code>infection rate</code> and <code>Initial inoculum</code> . There are presented the estimated values for each models and their associated related statistics. They are also sorted by <code>CCC</code>.</p>
<p>If you want to give a close look at the parameters you can call the <code>stats_all</code> using the <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> operator.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">f_lin</span>$<span class="no">stats_all</span>)</pre></body></html></div>
<pre><code>## # A tibble: 4 x 12
##   best_model model      r   r_se r_ci_lwr r_ci_upr r_squared   RSE   CCC
##        &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1          1 Logi~ 0.0996 0.0327   0.0984   0.101      0.995 0.206 0.998
## 2          2 Gomp~ 0.0713 0.0711   0.0689   0.0737     0.960 0.446 0.979
## 3          3 Mono~ 0.0550 0.0964   0.0517   0.0583     0.885 0.606 0.939
## 4          4 Expo~ 0.0446 0.0964   0.0413   0.0478     0.834 0.605 0.910
## # ... with 3 more variables: y0 &lt;dbl&gt;, y0_ci_lwr &lt;dbl&gt;, y0_ci_upr &lt;dbl&gt;</code></pre>
</div>
<div id="predictions" class="section level4">
<h4 class="hasAnchor">
<a href="#predictions" class="anchor"></a>Predictions</h4>
<p>You can see the model prediction by calling the <code>data</code> using the <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> operator like above. In there you’ll find the data used for fitting (<code>y</code>) and prediction for each model (<code>predicted</code>). The column <code>linearized</code> contains the linearization of <code>y</code> for each model. And finally we have the residual in the column <code>residual</code>.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">f_lin</span>$<span class="no">data</span>)</pre></body></html></div>
<pre><code>##   time          y       model linearized  predicted     residual
## 1    0 0.01000000 Exponential  -4.605170 0.03043941 -0.020439405
## 2    5 0.01500528 Exponential  -4.199353 0.03803447 -0.023029191
## 3   10 0.03402059 Exponential  -3.380789 0.04752460 -0.013504016
## 4   15 0.05828692 Exponential  -2.842378 0.05938266 -0.001095745
## 5   20 0.06615314 Exponential  -2.715783 0.07419948 -0.008046334
## 6   25 0.08471828 Exponential  -2.468424 0.09271330 -0.007995020</code></pre>
</div>
<div id="plonting-using-the-function-plot_fit" class="section level3">
<h3 class="hasAnchor">
<a href="#plonting-using-the-function-plot_fit" class="anchor"></a>Plonting using the function <code>plot_fit()</code>
</h3>
<p>Using the function <code><a href="../reference/plot_fit.html">plot_fit()</a></code> you create a panel with the predictions for each model. You can also add some features of the <code>ggplot2</code> arsenal like themes and axis labels.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_fit.html">plot_fit</a></span>(<span class="no">f_lin</span>,
         <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">2</span>,
         <span class="kw">line_size</span> <span class="kw">=</span> <span class="fl">1</span>) +

  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>()+

  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Time"</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Disease intensity"</span>)</pre></body></html></div>
<p><img src="fitting_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>You can also select the model(s) you want to plot in the argument <code>models</code>. Here I selected just the <em>Logistic</em> model.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_fit.html">plot_fit</a></span>(<span class="no">f_lin</span>,
         <span class="kw">point_size</span> <span class="kw">=</span> <span class="fl">2</span>,
         <span class="kw">line_size</span> <span class="kw">=</span> <span class="fl">1</span>,
         <span class="kw">models</span> <span class="kw">=</span> <span class="st">"Logistic"</span>) +

  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>()+

  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Time"</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Disease intensity"</span>)</pre></body></html></div>
<p><img src="fitting_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
</div>
<div id="using-fit_nlin" class="section level2">
<h2 class="hasAnchor">
<a href="#using-fit_nlin" class="anchor"></a>Using <code>fit_nlin()</code>
</h2>
<p>The <code><a href="../reference/fit_nlin.html">fit_nlin()</a></code> offers the possibility to fit models using nonlinear regression using the Levenberg-Marquardt algorithm. It works like <code><a href="../reference/fit_lin.html">fit_lin()</a></code>, you can modify the starting values for the parameter <code>y0</code> and <code>r</code> in the <code>starting_par</code> argument. The output interpretation is analogous to the <code><a href="../reference/fit_lin.html">fit_lin()</a></code>.</p>
<blockquote>
<p>NOTE: If you encounter messages saying “matrix at initial parameter estimates”, try to modify the starting values for the parameters, that might solve the problem.</p>
</blockquote>
<p><code>Plot_fit</code> also works for this function output.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">f_nlin</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fit_nlin.html">fit_nlin</a></span>(<span class="kw">time</span> <span class="kw">=</span> <span class="no">dpc_data</span>$<span class="no">time</span>,
                   <span class="kw">y</span> <span class="kw">=</span> <span class="no">dpc_data</span>$<span class="no">random_y</span>,
                   <span class="kw">starting_par</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">y0</span> <span class="kw">=</span> <span class="fl">0.01</span>, <span class="kw">r</span> <span class="kw">=</span> <span class="fl">0.03</span>))

<span class="no">f_nlin</span></pre></body></html></div>
<pre><code>## Results of fitting population models 
## 
## Stats:
##                  CCC r_squared    RSE
## Logistic      0.9982    0.9963 0.0240
## Gompertz      0.9961    0.9934 0.0352
## Monomolecular 0.9176    0.8711 0.1487
## Exponential   0.8885    0.8265 0.1705
## 
##  Infection rate:
##                 Estimate   Std.error      Lower      Upper
## Logistic      0.09987271 0.001387037 0.09713129 0.09713129
## Gompertz      0.06994685 0.001375333 0.06722856 0.06722856
## Monomolecular 0.02365312 0.001091005 0.02149679 0.02149679
## Exponential   0.01943713 0.001007115 0.01744660 0.01744660
## 
##  Initial inoculum:
##                    Estimate    Std.error         Lower         Upper
## Logistic       1.026930e-02 6.644790e-04  8.955987e-03  1.158262e-02
## Gompertz       1.994030e-07 1.881083e-07 -1.723855e-07  5.711915e-07
## Monomolecular -2.383045e-01 3.551263e-02 -3.084938e-01 -1.681152e-01
## Exponential    1.796710e-01 1.473266e-02  1.505524e-01  2.087895e-01</code></pre>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_fit.html">plot_fit</a></span>(<span class="no">f_nlin</span>)+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>()</pre></body></html></div>
<p><img src="fitting_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div id="using-fit_nlin2" class="section level2">
<h2 class="hasAnchor">
<a href="#using-fit_nlin2" class="anchor"></a>Using <code>fit_nlin2()</code>
</h2>
<p>It is not always that a DPC reaches the maximum 100% intensity. When this does happens we often wont to estimate this value of maximum disease intensity and we usually denote it as <code>K</code>. Using the function <code>fin_lin2</code> we can fit the models and estimate the maximum disease intensity for your DPCs</p>
<p>Let’s modify our data to have a maximum disease intensity of 0.8 (80%). We do that just multiplying the data to 0.8.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">dpc_data2</span> <span class="kw">=</span> <span class="no">dpc_data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">random_y</span> <span class="kw">=</span> <span class="no">random_y</span>*<span class="fl">0.8</span>)</pre></body></html></div>
<p>Now we just put the data into the <code><a href="../reference/fit_nlin2.html">fit_nlin2()</a></code> function. Here you can modify the stating parameter as well.</p>
<blockquote>
<p>NOTE: The exponential model is left aside here, becouse it doesn’t have a maximum asymptote.</p>
</blockquote>
<p>See that the estimated value of <code>K</code> is just what we were expecting 0.8!</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">f_nlin2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fit_nlin2.html">fit_nlin2</a></span>(<span class="kw">time</span> <span class="kw">=</span> <span class="no">dpc_data2</span>$<span class="no">time</span>,
                     <span class="kw">y</span> <span class="kw">=</span> <span class="no">dpc_data2</span>$<span class="no">random_y</span>)
<span class="no">f_nlin2</span></pre></body></html></div>
<pre><code>## Results of fitting population models 
## 
## Stats:
##                  CCC r_squared    RSE
## Logistic      0.9982    0.9963 0.0193
## Gompertz      0.9968    0.9941 0.0257
## Monomolecular 0.9698    0.9413 0.0770
## 
##  Infection rate:
##                  Estimate   Std.error       Lower       Upper
## Logistic      0.100077476 0.001709270 0.096698975 0.096698975
## Gompertz      0.062798682 0.001638548 0.059559968 0.059559968
## Monomolecular 0.004587874 0.001550572 0.001523051 0.001523051
## 
##  Initial inoculum:
##                    Estimate    Std.error         Lower         Upper
## Logistic       8.154183e-03 6.067207e-04  6.954954e-03  9.353412e-03
## Gompertz       4.388289e-06 3.362138e-06 -2.257229e-06  1.103381e-05
## Monomolecular -1.087867e-01 1.807681e-02 -1.445168e-01 -7.305648e-02
## 
##  Maximum disease intensity:
##                Estimate   Std.error     Lower     Upper
## Logistic      0.7992658 0.003523926 0.7923005 0.8062312
## Gompertz      0.8329006 0.006472490 0.8201073 0.8456940
## Monomolecular 2.6322598 0.742171216 1.1653027 4.0992170</code></pre>
</div>
<div id="using-multi_fitter" class="section level2">
<h2 class="hasAnchor">
<a href="#using-multi_fitter" class="anchor"></a>Using <code>multi_fitter</code>
</h2>
<p>Okay, now that we saw how to fit models to single epidemics, we are ready to see how to do it for more the one DPC. The <code>epifitter</code> also offers the option to you fit the models to various DPCs using the function <code><a href="../reference/multi_fitter.html">multi_fitter()</a></code>. You just need to put all your DPC data into a single <code>data.frame</code> and identify each one with strata columns.</p>
<div id="data-1" class="section level3">
<h3 class="hasAnchor">
<a href="#data-1" class="anchor"></a>Data</h3>
<p>Here I will create a <code>data.frame</code> containing three DPCs. Note that the I change the <code>y0</code> and <code>r</code> parameter to get different DPCs. I used the Gompertz model to simulate these data, so we expect that the best model would be the same, just like we saw above.</p>
<p>I called the strata column ‘DPC’, so in it that we have the DPC 1, 2 and 3.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">epi1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_gompertz.html">sim_gompertz</a></span>(<span class="kw">N</span> <span class="kw">=</span> <span class="fl">60</span>, <span class="kw">y0</span> <span class="kw">=</span> <span class="fl">0.001</span>, <span class="kw">dt</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">r</span> <span class="kw">=</span> <span class="fl">0.1</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.4</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">4</span>)
<span class="no">epi2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_gompertz.html">sim_gompertz</a></span>(<span class="kw">N</span> <span class="kw">=</span> <span class="fl">60</span>, <span class="kw">y0</span> <span class="kw">=</span> <span class="fl">0.001</span>, <span class="kw">dt</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">r</span> <span class="kw">=</span> <span class="fl">0.12</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.4</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">4</span>)
<span class="no">epi3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_gompertz.html">sim_gompertz</a></span>(<span class="kw">N</span> <span class="kw">=</span> <span class="fl">60</span>, <span class="kw">y0</span> <span class="kw">=</span> <span class="fl">0.003</span>, <span class="kw">dt</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">r</span> <span class="kw">=</span> <span class="fl">0.12</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.4</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">4</span>)

<span class="no">multi_epidemic</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(<span class="no">epi1</span>,
                            <span class="no">epi2</span>,
                            <span class="no">epi3</span>,
                            <span class="kw">.id</span> <span class="kw">=</span> <span class="st">"DPC"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">multi_epidemic</span>)</pre></body></html></div>
<pre><code>##   DPC replicates time          y    random_y
## 1   1          1    0 0.00100000 0.001000000
## 2   1          1    5 0.01515505 0.006347237
## 3   1          1   10 0.07878459 0.092927031
## 4   1          1   15 0.21411521 0.105370656
## 5   1          1   20 0.39266393 0.440370121
## 6   1          1   25 0.56723412 0.530218763</code></pre>
</div>
<div id="multi-fitting" class="section level3">
<h3 class="hasAnchor">
<a href="#multi-fitting" class="anchor"></a>“Multi fitting”</h3>
<p>To fit the model to all your DPCs, use the function <code>multi_fitter</code>.</p>
<p>For that, inform the column in which are you time steps in the <code>time_col</code> argument.</p>
<p>In the <code>intensity_col</code> inform the name of the column where is your disease intensity data (incidence, severity, …).</p>
<p>Inform you <code>data.frame</code> in the <code>data</code> argument.</p>
<p>In strata_cols you have to inform the name of your strata column.In this example its name is “DPC”, but you can have more than one strata column, you can inform that putting the columns names in a vector like this <code>c("strata1",strata2")</code>.</p>
<p>Informing only this arguments, it fit the models using linear regression of the linearized data, like in <code><a href="../reference/fit_lin.html">fit_lin()</a></code>.</p>
<p>You can see the parameters calling <code>Parameters</code> using the <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> operator. The column <code>best model</code> gives the order of higher accuracy of the model.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">multi_fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/multi_fitter.html">multi_fitter</a></span>(<span class="kw">time_col</span> <span class="kw">=</span> <span class="st">"time"</span>,
                          <span class="kw">intensity_col</span> <span class="kw">=</span> <span class="st">"random_y"</span>,
                          <span class="kw">data</span> <span class="kw">=</span> <span class="no">multi_epidemic</span>,
                          <span class="kw">strata_cols</span> <span class="kw">=</span> <span class="st">"DPC"</span>)


<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">multi_fit</span>$<span class="no">Parameters</span>)</pre></body></html></div>
<pre><code>##   DPC best_model         model          r      r_se   r_ci_lwr   r_ci_upr
## 1   1          1      Gompertz 0.09991061 0.0843150 0.09512062 0.10470060
## 2   1          2 Monomolecular 0.07164240 0.1061270 0.06561325 0.07767154
## 3   1          3      Logistic 0.15846211 0.2495049 0.14428758 0.17263664
## 4   1          4   Exponential 0.08681971 0.3059496 0.06943853 0.10420090
## 5   2          1      Gompertz 0.12611271 0.1303548 0.11870718 0.13351825
## 6   2          2      Logistic 0.17836854 0.2742925 0.16278582 0.19395127
##   r_squared       RSE       CCC            y0     y0_ci_lwr    y0_ci_upr
## 1 0.9723021 0.3217255 0.9859565  0.0008440838  0.0002286605  0.002542248
## 2 0.9193076 0.4049548 0.9579576 -0.8568890458 -1.2980590620 -0.500412668
## 3 0.9097798 0.9520500 0.9527589  0.0098848608  0.0060120328  0.016211795
## 4 0.6681219 1.1674291 0.8010468  0.0185383387  0.0100274184  0.034273029
## 5 0.9590153 0.4974021 0.9790789  0.0008693197  0.0001054575  0.004408119
## 6 0.9135830 1.0466333 0.9548402  0.0139827046  0.0081078205  0.024011449</code></pre>
<p>You can also see the data calling <code>Data</code>.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">multi_fit</span>$<span class="no">Data</span>)</pre></body></html></div>
<pre><code>##   DPC time           y       model linearized  predicted    residual
## 1   1    0 0.001000000 Exponential -6.9077553 0.01853834 -0.01753834
## 2   1    5 0.006347237 Exponential -5.0597357 0.02861524 -0.02226801
## 3   1   10 0.092927031 Exponential -2.3759407 0.04416966  0.04875737
## 4   1   15 0.105370656 Exponential -2.2502711 0.06817900  0.03719165
## 5   1   20 0.440370121 Exponential -0.8201397 0.10523913  0.33513099
## 6   1   25 0.530218763 Exponential -0.6344656 0.16244407  0.36777469</code></pre>
<p>If you rather use nonlinear regression, set <code>TRUE</code> in the <code>nlim</code> argument.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">multi_fit2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/multi_fitter.html">multi_fitter</a></span>(<span class="kw">time_col</span> <span class="kw">=</span> <span class="st">"time"</span>,
                            <span class="kw">intensity_col</span> <span class="kw">=</span> <span class="st">"random_y"</span>,
                            <span class="kw">data</span> <span class="kw">=</span> <span class="no">multi_epidemic</span>,
                            <span class="kw">strata_cols</span> <span class="kw">=</span> <span class="st">"DPC"</span>,
                            <span class="kw">nlin</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>## Warning in log(y0/1): NaNs produzidos

## Warning in log(y0/1): NaNs produzidos

## Warning in log(y0/1): NaNs produzidos

## Warning in log(y0/1): NaNs produzidos</code></pre>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">multi_fit2</span>$<span class="no">Parameters</span>)</pre></body></html></div>
<pre><code>##   DPC         model            y0        y0_se          r        r_se df
## 1   1      Gompertz  0.0008571829 0.0008097216 0.09705932 0.005497937 50
## 2   1      Logistic  0.0282368385 0.0061037700 0.14187762 0.008489558 50
## 3   1 Monomolecular -0.1808475046 0.0488461998 0.04133455 0.002827209 50
## 4   1   Exponential  0.2180868284 0.0285854332 0.02833285 0.002702940 50
## 5   2      Gompertz  0.0008357373 0.0005934011 0.12723373 0.005381271 50
## 6   2      Logistic  0.0299726164 0.0057573405 0.18337675 0.009923135 50
##         CCC r_squared        RSE     y0_ci_lwr    y0_ci_upr   r_ci_lwr
## 1 0.9856828 0.9719268 0.06480053 -0.0007691909  0.002483557 0.08601638
## 2 0.9854686 0.9720656 0.06525284  0.0159770557  0.040496621 0.12482584
## 3 0.9381082 0.8985444 0.12773187 -0.2789579843 -0.082737025 0.03565594
## 4 0.8667044 0.7929156 0.18031176  0.1606712961  0.275502361 0.02290384
## 5 0.9938845 0.9878771 0.04256495 -0.0003561438  0.002027618 0.11642513
## 6 0.9907861 0.9836113 0.05199270  0.0184086576  0.041536575 0.16344555
##     r_ci_upr best_model
## 1 0.10810225          1
## 2 0.15892940          2
## 3 0.04701317          3
## 4 0.03376187          4
## 5 0.13804233          1
## 6 0.20330795          2</code></pre>
</div>
<div id="estimate-k" class="section level3">
<h3 class="hasAnchor">
<a href="#estimate-k" class="anchor"></a>Estimate K?</h3>
<p>You might want to estimate <code>K</code> for your data. To do that, set <code>nlin = TRUE</code> and <code>estimate_K = TRUE</code>.</p>
<blockquote>
<p>NOTE: If you do not set both <code>TRUE</code>, <code>K</code> will not be estimated, because <code>nlin</code> defaut is <code>FALSE</code>. Also remember that when estimating K, we don’t fit the <em>Exponential</em> model.</p>
</blockquote>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">multi_fit_K</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/multi_fitter.html">multi_fitter</a></span>(<span class="kw">time_col</span> <span class="kw">=</span> <span class="st">"time"</span>,
                            <span class="kw">intensity_col</span> <span class="kw">=</span> <span class="st">"random_y"</span>,
                            <span class="kw">data</span> <span class="kw">=</span> <span class="no">multi_epidemic</span>,
                            <span class="kw">strata_cols</span> <span class="kw">=</span> <span class="st">"DPC"</span>,
                            <span class="kw">nlin</span> <span class="kw">=</span> <span class="no">T</span>,
                            <span class="kw">estimate_K</span> <span class="kw">=</span> <span class="no">T</span>)</pre></body></html></div>
<pre><code>## Warning in log(y0/K): NaNs produzidos

## Warning in log(y0/K): NaNs produzidos

## Warning in log(y0/K): NaNs produzidos

## Warning in log(y0/K): NaNs produzidos</code></pre>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">multi_fit_K</span>$<span class="no">Parameters</span>)</pre></body></html></div>
<pre><code>##   DPC         model            y0       y0_se          r        r_se         K
## 1   1      Gompertz  0.0013852531 0.001472489 0.09262963 0.008113973 1.0186356
## 2   1      Logistic  0.0243908652 0.006419807 0.15003866 0.011487503 0.9753126
## 3   1 Monomolecular -0.1132283745 0.037446268 0.01694448 0.004548452 1.7352222
## 4   2      Gompertz  0.0005489269 0.000490857 0.13170394 0.007228859 0.9892744
## 5   2      Logistic  0.0239301503 0.005226121 0.19965243 0.012137734 0.9697864
## 6   2 Monomolecular -0.1285300306 0.037879042 0.03622426 0.004726538 1.2178905
##         K_se df       CCC r_squared        RSE     y0_ci_lwr    y0_ci_upr
## 1 0.02681505 49 0.9859103 0.9721406 0.06509759 -0.0015738248  0.004344331
## 2 0.01909592 49 0.9857723 0.9725924 0.06487177  0.0114897807  0.037291950
## 3 0.31059560 49 0.9681752 0.9383135 0.09684255 -0.1884794681 -0.037977281
## 4 0.01095462 49 0.9939639 0.9879948 0.04260527 -0.0004374872  0.001535341
## 5 0.01083109 49 0.9917758 0.9846436 0.04914377  0.0134278669  0.034432434
## 6 0.07167852 49 0.9715442 0.9446630 0.09147025 -0.2046508160 -0.052409245
##      r_ci_lwr   r_ci_upr  K_ci_lwr  K_ci_upr best_model
## 1 0.076323987 0.10893527 0.9647488 1.0725225          1
## 2 0.126953660 0.17312366 0.9369380 1.0136873          2
## 3 0.007804028 0.02608494 1.1110570 2.3593874          3
## 4 0.117177004 0.14623087 0.9672602 1.0112885          1
## 5 0.175260739 0.22404412 0.9480205 0.9915523          2
## 6 0.026725923 0.04572259 1.0738472 1.3619339          3</code></pre>
</div>
</div>
<div id="make-graphics-to-compare-curves-and-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#make-graphics-to-compare-curves-and-parameters" class="anchor"></a>Make graphics to compare curves and parameters</h2>
<p>Use <a href="https://ggplot2.tidyverse.org/"><code>ggplot2</code></a> to produce elegant data visualizations of the model curves and the estimated parameters.</p>
<div id="curves" class="section level3">
<h3 class="hasAnchor">
<a href="#curves" class="anchor"></a>Curves</h3>
<p>The original data and the predicted values for each model are in <code>multi_fit$Data</code>. See how we can plot the data and the predicted curves for each model and each DPC.</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">multi_fit</span>$<span class="no">Data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">time</span>, <span class="no">predicted</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">DPC</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">time</span>, <span class="no">y</span>), <span class="kw">color</span> <span class="kw">=</span> <span class="st">"gray"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw">size</span>  <span class="kw">=</span><span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(<span class="no">DPC</span>~<span class="no">model</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">"free_y"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span>()+
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span>(<span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>))</pre></body></html></div>
<p><img src="fitting_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>You can filter the data for specific model and plot it. To filter a model, use the function <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> from the <code>dplyr</code> package.</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">multi_fit</span>$<span class="no">Data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">model</span> <span class="kw">==</span> <span class="st">"Gompertz"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">time</span>, <span class="no">predicted</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">DPC</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">time</span>, <span class="no">y</span>),
    <span class="kw">color</span> <span class="kw">=</span> <span class="st">"gray"</span>,
    <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>
  ) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.2</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(
    <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Time"</span>,
    <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Disease Intensity"</span>
  )</pre></body></html></div>
<p><img src="fitting_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
</div>
<div id="apparent-infection-rate" class="section level3">
<h3 class="hasAnchor">
<a href="#apparent-infection-rate" class="anchor"></a>Apparent infection rate</h3>
<p>Access the estimated parameters calling <code>multi_fit$Parameters</code> and plot too.</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="no">multi_fit</span>$<span class="no">Parameters</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">model</span> <span class="kw">==</span> <span class="st">"Gompertz"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">DPC</span>, <span class="no">r</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">r_ci_lwr</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">r_ci_upr</span>),
    <span class="kw">width</span> <span class="kw">=</span> <span class="fl">0</span>,
    <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1</span>
  ) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(
    <span class="kw">x</span> <span class="kw">=</span> <span class="st">"Time"</span>,
    <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Apparent infection rate"</span>
  ) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span>()</pre></body></html></div>
<p><img src="fitting_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>Lin L (2000). A note on the concordance correlation coefficient. Biometrics 56: 324 - 325.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kaique Alves, Emerson Del Ponte.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
